<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.cp.dao.UserMapperExtra" >
	<select id="getUserById" resultType="java.util.HashMap">
		SELECT u.id,u.`code`,nickname,create_time AS createTime,role_id AS roleId,r.`name` AS roleName,o.`name` AS operatorName
		FROM `user` AS u LEFT JOIN role AS r ON u.role_id = r.id LEFT JOIN operator AS o ON r.creator_id = o.user_id
		WHERE u.id = #{id,jdbcType=VARCHAR}
	</select>
	
	<delete id="deleteUsers">
		DELETE FROM `user` WHERE id IN 
		<foreach collection="ids" item="id" open="(" separator="," close=")">
			#{id,jdbcType=VARCHAR}
		</foreach>
	</delete>
	
	<sql id="limitCondition">
		<if test="start >= 0">
			LIMIT #{start,jdbcType=INTEGER},#{end,jdbcType=INTEGER}
		</if>
	</sql>
	
	<select id="getUsers" resultType="java.util.HashMap">
		SELECT u.id,u.`code`,nickname,create_time AS createTime,role_id AS roleId,r.`name` AS roleName,o.`name` AS operatorName
		FROM `user` AS u LEFT JOIN role AS r ON u.role_id = r.id  
		LEFT JOIN operator AS o ON r.creator_id = o.user_id WHERE 1 = 1
		<if test="userId != null">
			AND o.user_id = #{userId,jdbcType=VARCHAR}
		</if>
		<if test="usDTO.nickname != null">
			AND u.nickname LIKE <![CDATA[CONCAT('%',#{usDTO.nickname,jdbcType=VARCHAR},'%')]]>
		</if>
		<if test="usDTO.code != null">
			AND u.code LIKE <![CDATA[CONCAT('%',#{usDTO.code,jdbcType=VARCHAR},'%')]]>
		</if>
		<if test="usDTO.operatorName != null">
			AND o.`name` LIKE <![CDATA[CONCAT('%',#{usDTO.operatorName,jdbcType=VARCHAR},'%')]]>
		</if>
		<include refid="limitCondition"></include>
	</select>
</mapper>